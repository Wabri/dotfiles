#! /usr/bin/env bash

notification_time=350
vol_up=2%+
vol_down=2%-

actual_volume=$(amixer sget Master | grep "Front Right:" | awk -F'[][]' '{ print $2 }';)
 
if [ -z $1 ] ; then
    echo "Usage: i3media {vol_up|vol_down|vol_toggle|mic_toggle}"
    exit 2
elif [ $actual_volume = "100%" ] && [ $1 = "vol_up" ] ; then
    exit 1
elif [ $actual_volume = "0%" ] && [ $1 = "vol_down" ] ; then
    exit 1
else
    case "$1" in
        vol_up)
            amixer set Master unmute
            amixer set Master $vol_up
            volume_percentage=$(amixer sget Master | grep "Front Right:" | awk -F'[][]' '{ print $2 }')
            notify-send --expire-time=$notification_time --urgency=low "$volume_percentage "
        ;;
        vol_down)
            amixer set Master $vol_down
            volume_percentage=$(amixer sget Master | grep "Front Right:" | awk -F'[][]' '{ print $2 }')
            notify-send --expire-time=$notification_time --urgency=low "$volume_percentage "
        ;;
        vol_toggle)
            amixer set Master toggle
            volume_percentage=$(amixer sget Master | grep "Front Right:" | awk -F'[][]' '{ print $2 }')
            volume_status=$(amixer sget Master | grep "Front Right:" | awk -F'[][]' '{ print $4 }')
    	if [ $volume_status = "on" ] ; then
                notify-send --urgency=normal --expire-time=$[ 2 * $notification_time ] "$volume_percentage "
    	else
                notify-send --urgency=critical --expire-time=$[ 2 * $notification_time ] "Mute "
    	fi
        ;;
        mic_toggle)
            amixer set Capture toggle
            mic_status=$(amixer sget Capture | grep "Front Right:" | awk -F'[][]' '{ print $4 }')
    	if [ $mic_status = "on" ] ; then
                notify-send --urgency=normal --expire-time=$[ 2 * $notification_time ] ""
    	else
                notify-send --urgency=critical --expire-time=$[ 2 * $notification_time ] ""
    	fi
        ;;
        *)
            exit 2
        ;;
    esac
fi

