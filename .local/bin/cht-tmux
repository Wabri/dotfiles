#!/usr/bin/env bash
fzf_args='--border=rounded --margin=2,4,2,4 --layout=reverse'

languages=`cat ~/.local/share/cht/languages | tr ' ' '\n'`
commands=`cat ~/.local/share/cht/commands | tr ' ' '\n'`

selected=`printf "$languages\n$commands" | fzf $fzf_args`
if [[ -z $selected ]]; then
    exit 0
fi

read -p "query: " query

execute="curl cht.sh/$selected"

if [[ $languages[*] =~ $selected ]]; then
	execute+='/'
else
	execute+='~'
fi
execute+="`echo $query | tr ' ' '+'`& while [ : ]; do sleep 1; done"

tmux neww "$execute"

