#!/usr/bin/env bash

workspace_dir=~/Documents/Workspaces
workspace=`basename $(ls -d $workspace_dir/*) | fzf`

tmux has-session -t $workspace >/dev/null

if [ $? != 0 ]; then
  tmux new-session -d -s $workspace -c "$workspace_dir/$workspace" 
  
  projects=`ls -1 -m -d $workspace_dir/$workspace/* | tr ', ' '\n'`
  window=2
  for project in $projects
  do
     tmux new-window -t $workspace:$window -n $(basename $project) -c "$project" 
     if [ -f $project/Session.vim ]; then
        tmux send-keys -t $workspace:$window "vim" C-m
     fi
     window=$((window + 1))
  done
  tmux kill-window -t$workspace:1
else
  [ -z "${TMUX}" ] && tmux attach-session -t $workspace
fi

