#----------------------------------------------------------------
# Misc settings
#----------------------------------------------------------------

# upgrade $TERM
set-option -g default-terminal "screen-256color"
set-option -sa terminal-features ',xterm-kitty:RGB'

#----------------------------------------------------------------
# Configurations
#----------------------------------------------------------------
# Set vim mode
setw -g mode-keys vi

# Mouse can be use to select panes, windows and resize
set -g mouse on

# Disable "release mouse drag to copy and exit copy-mode"
unbind-key -T copy-mode-vi MouseDragEnd1Pane

# Start window and pane numbering at 1, (0 is too hard to reach).
set -g base-index 1
set -g pane-base-index 1

# Automatically renumber window numbers on closing a pane
set -g renumber-windows on

# Dynamically update term tab and window titles.
set -g set-titles on

# Session status must be visible
set -g status-left-length 80

# Set escape time
set-option -sg escape-time 10

# Set focus event
set-option -g focus-events on

#----------------------------------------------------------------
# Shortcuts
#----------------------------------------------------------------

# Rebind Ctrl + b
unbind C-b
set -g prefix M-p

# Rebind new window to create on current path
unbind c
bind c new-window -c "#{pane_current_path}"

# Rebind split vertical to create on current path
#unbind '"'
#bind - split-window -v -c "#{pane_current_path}"

# Rebind split horizontal to create on current path
#unbind %
#bind \ split-window -h -c "#{pane_current_path}"

# Pane movement
bind-key J choose-window 'join-pane -t "%%"'

# Resizing
unbind Left
bind -r Left resize-pane -L 5
unbind Down
bind -r Down resize-pane -D 5
unbind Up
bind -r Up resize-pane -U 5
unbind Right
bind -r Right resize-pane -R 5

# New session
unbind t
bind -r t new-session

# New workspace with steps
# unbind W
# bind-key W display-popup -E "~/.local/bin/tmux-commands/tmux-workspace steps"

# New workspace
# unbind w
# bind-key w display-popup -E "~/.local/bin/tmux-commands/tmux-workspace full"

# New project
# unbind G
# bind-key G display-popup -E "~/.local/bin/tmux-commands/tmux-gitclone"

# Manage git worktree
# unbind g
# bind-key g display-popup -E "~/.local/bin/tmux-commands/tmux-gitworktree"

# cht.sh
# unbind f
# bind-key f display-popup -E "~/.local/bin/tmux-commands/tmux-cht"

# cheat-search
# unbind F
# bind-key F split-window -h -l 40% "tldr --list | fzf --preview \"tldr {1}\" --preview-window=right,70% | xargs tldr & while [ : ]; do sleep 1; done"

# More vim-like copy + paste
bind-key -T copy-mode-vi 'v' send -X begin-selection     # Begin selection in copy mode.
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle  # Begin selection in copy mode.
bind-key -T copy-mode-vi 'y' send -X copy-selection      # Yank selection in copy mode.
bind-key p paste-buffer                                  # Paste contents of buffer

#----------------------------------------------------------------
# List of plugins
#----------------------------------------------------------------
set -g @tpm_plugins '                \
  tmux-plugins/tpm                   \
  wabri/tmux-nord-plusplus           \
  wabri/tmux-tsaheylu                \
  2kabhishek/tmux-tilit              \
  tmux-plugins/tmux-sensible         \
  sainnhe/tmux-fzf                   \
  tmux-plugins/tmux-battery          \
  olimorris/tmux-pomodoro-plus       \
  tmux-plugins/tmux-yank             \
  tmux-plugins/tmux-resurrect        \
  tmux-plugins/tmux-continuum        \
'

#----------------------------------------------------------------
# Plugins configuration
#----------------------------------------------------------------
# Restore previous sessions
set -g @workspace_dir '~/Workspaces/'
set -g @worktree_abilitate 'true'
set -g @bind_open_project 'W'
set -g @bind_cloning_project 'G'
set -g @bind_worktree_management 'g'

# Restore previous sessions
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'

# Pomodoro
set -g @pomodoro_start 'p'                  # Start a Pomodoro with tmux-prefix + p
set -g @pomodoro_cancel 'P'                 # Cancel a Pomodoro with tmux-prefix key + P
set -g @pomodoro_mins 25                    # The duration of the pomodoro
set -g @pomodoro_break_mins 5               # The duration of the break after the pomodoro
set -g @pomodoro_repeat false               # Auto-repeat the pomodoro? False by default
set -g @pomodoro_on " üçÖ"                   # The formatted output when the pomodoro is running
set -g @pomodoro_complete " ‚úÖ"             # The formatted output when the break is running
set -g @pomodoro_notifications 'on'        # Enable desktop notifications from your terminal
set -g @pomodoro_sound 'on'                # Sound for desktop notifications (Run `ls /System/Library/Sounds` for a list of sounds to use on Mac)
set -g @pomodoro_granularity 'on'          # Enables MM:SS (ex: 00:10) format instead of the default (ex: 1m)

run '~/.tmux/plugins/tpm/tpm'
